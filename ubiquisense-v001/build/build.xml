<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="sign-app" name="Sign ubiquisense app and corresponding resources">
	
	<target name="sign-app">
	   <property name="aliasName" value="ubiquisense"/>
	   <property name="password" value="ubiquisense"/>
	   <property name="keystoreFileName" location="./keystore/ubiquisense.keystore"/>
	   <property name="firstNameSurName" value="Lucas Bigeardel"/>
	   <property name="organisationUnitOrDepartment" value="Labs"/>
	   <property name="organisationName" value="Ubiquisense"/>
	   <property name="cityOrLocality" value="Toulouse"/>
	   <property name="stateOrProvince" value="Haute-Garonne"/>
	   <property name="twoLetterJavaLocaleCountryCode" value="FR"/>
	   <property name="validity" value="10000"/>
	          
	   <delete file="${keystoreFileName}" failonerror="false" />
	   <genkey alias="${aliasName}" storepass="${password}" keystore="${keystoreFileName}" validity="${validity}">
	      <dname>
	      <param name="CN" value="${firstNameSurName}"/>
	      <param name="OU" value="${organisationUnitOrDepartment}"/>
	      <param name="O"  value="${organisationName}"/>
	      <param name="L"  value="${cityOrLocality}"/>
	      <param name="ST"  value="${stateOrProvince}"/>
	      <param name="C"  value="${twoLetterJavaLocaleCountryCode}"/>   
	      </dname>
	   </genkey>
	</target>
	
	<target name="sign-jar">
	   <delete dir="./distSigned" failonerror="false" />
	   <mkdir dir="./distSigned" />
	   <signjar destDir="distSigned"
	      alias="${aliasName}" keystore="${keystoreFileName}"
	      storepass="${password}"
	      preservelastmodified="true">
	      <path>
	      <fileset dir="./libs" includes="*.jar" />
	      </path>
	      <flattenmapper />
	   </signjar>

	   <mkdir dir="./distSigned/lib" />
	   <signjar destDir="./distSigned/lib"
	      alias="${aliasName}" keystore="${keystoreFileName}"
	      storepass="${password}"
	      preservelastmodified="true">
	      <path>
	      <fileset dir="./libs" includes="*.jar" />
	      </path>
	      <flattenmapper />
	   </signjar>
	</target>
	
	<target name="apk-align">
	  <exec executable="/Developer/adt-bundle-mac-x86_64-20130514/sdk/tools/zipalign">
	    <arg value="4"/>
	    <arg value="ubiquisense-v001.apk"/>
	    <arg value="ubiquisense.apk"/>
	  </exec>
	</target>	
	
	<!-- 
	/Developer/adt-bundle-mac-x86_64-20130514/sdk/tools/zipalign 4 ubiquisense-v001.apk ubiquisense.apk
	 -->
</project>